<!--
    %\VignetteEngine{knitr::knitr}
    %\VignetteIndexEntry{Markdown example with knitr and googleVis}
-->

---
title: "Severe Weather Events Analysis"
output: html_document
---

##Synopsis

This report explores the NOAA Storm Events Database in an attempt to determine which types of severe weather events are most harmful in terms of not only property, but population health as well.  The purpose of this report is to provide government or municipal manager(s) with a enough information to make informed decisions as it pertains to effectively allocating limited resources.

[Findings...]


```{r Libraries, include=F, eval=T, echo=F}
    suppressWarnings(library(ggplot2));
    suppressWarnings(library(dplyr));
    suppressWarnings(library(plyr));
    suppressWarnings(library(downloader));
    suppressWarnings(library(R.utils));
    suppressWarnings(library(googleVis));
    suppressWarnings(library(formatR));
```

```{r echo=F}
    op <- options(gvis.plot.tag='chart');
```


###Download & Uncompress Dataset
```{r DownloadData, eval=F, echo=T}
    knitr::opts_chunk$set(cache=T);

    setwd("~/Data Science/05 Reproducible Research");
    
    csv <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2";
    download(csv, "repdata-data-StormData.csv.bz2", mode="wb");
    bunzip2("repdata-data-StormData.csv.bz2", "StormData.csv", overwrite=T);
```


###Read CSV File & Process Data
```{r ReadProcessCSV, eval=T, echo=T, cache=T}

#   Reading NOAA Data from CSV File
    NOAA_Full <- read.csv("StormData.csv", na.strings=c("","  ", "NA"),
        header=TRUE, sep=",", stringsAsFactors=FALSE, strip.white=TRUE, comment.char="",
        quote = '\"')[,1:35];  # Dropping Last Two Variables
    
    dim(NOAA_Full);
        
#   Appending State Names to Dataset
    StateNames <- suppressWarnings(read.csv("states.csv"));
    StormDataFull <- merge(x=NOAA_Full, y=StateNames, by="STATE", all.x=T);
    
    dim(StateNames);

#   Converting Units for PROPDMGEXP & CROPDMGEXP
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="M"] <- 1000;
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="K"] <- 1;
    StormDataFull$PROP_SCALE[is.na(StormDataFull$PROPDMGEXP)==T] <- 1;

    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="M"] <- 1000;
    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="K"] <- 1;
    StormDataFull$CROP_SCALE[is.na(StormDataFull$CROPDMGEXP)==T] <- 1;
```


###Property & Population Health
Severe weather events are evaluated in terms of their impact on both property and population health.  These quantitative measures are defined as follows:

Economic Impact = Amount of Property Damage + Amount of Crop Damage

Population Health = Number of Injuries + Number of Fatalities
````{r}
#   Scaling and Grouping Values for Property & Crop Damage 
    StormDataFull$ECONOMIC <- (StormDataFull$PROPDMG * StormDataFull$PROP_SCALE) + 
        (StormDataFull$CROPDMG * StormDataFull$CROP_SCALE);

#   Scaling and Combining Values for Injuries & Fatalities
    StormDataFull$HEALTH <- StormDataFull$INJURIES + StormDataFull$FATALITIES;

#   Narrow Scope of Dataset
    StormData <- StormDataFull[, c("STATE_NAME", "EVTYPE", "ECONOMIC", "HEALTH")];
```


###Economic Impact
Total Property Damage ($ Billions)
```{r EconomicsImpactMap, include=T, echo=F, results='asis'}
#   Aggregate Property Damage Data by State
    StormData_ECONOMIC <- ddply(StormData, "STATE_NAME", summarise, 
        ECONOMIC=sum(ECONOMIC, na.rm=T)/1000000);  # Round to Billions
    StormData_ECONOMIC$ECONOMIC <- round(StormData_ECONOMIC$ECONOMIC, digits=2);
    
    Geo1 <- gvisGeoMap(StormData_ECONOMIC, locationvar='STATE_NAME', numvar='ECONOMIC', 
        options=list(region='US', colors='[0xA36685, 0x470024]', 
        dataMode='regions', height=350, width=600));
    plot(Geo1);
```
Texas was the hardest hit with a total of $19.5 Billion in combined property and crop damage from JAN 1950 through NOV 2011.


```{r EconomicsImpactGraph, include=T, echo=F, results='asis'}
#   Narrow Scope to Most Effected State: Texas
    ECONOMIC_TX_FULL <- subset(StormData, STATE_NAME=="Texas");
    ECONOMIC_TX <- ddply(ECONOMIC_TX_FULL, .(STATE_NAME, EVTYPE), summarise, 
        ECONOMIC=sum(ECONOMIC));

#   Top 5 EVTYPE
    ECONOMIC <- head(ECONOMIC_TX[order(-ECONOMIC_TX$ECONOMIC), ], n=5);
    
    g1 <- ggplot(data=ECONOMIC, aes(x="", y=ECONOMIC/sum(ECONOMIC), fill=EVTYPE))
    g1 <- g1 + geom_bar(width=.5, stat="identity")
    g1 <- g1 + ggtitle("Top 5 Event Types Affecting Property") 
    g1 <- g1 + labs(x="Texas", y="Injuries/Fatalities (%)")
    g1
```

The top five (5) extreme weather events responsible well over 80% of the total amount of property in the state of Texas: 1) Hail, 2) Flood, 3) Flash Flood, 4) Wild Fire, and 5) TSTM Wind.


###Population Health
Total Number of Injuries & Fatalities
```{r PopulationHealthMap, include=T, echo=F, results='asis'}
#   Aggregate Population Health Data by State
    StormData_HEALTH <- ddply(StormData, "STATE_NAME", summarise, HEALTH=sum(HEALTH, 
        na.rm= T));
    
    Geo2 <- gvisGeoMap(StormData_HEALTH, locationvar='STATE_NAME', numvar='HEALTH', 
        options=list(region='US', colors='[0x8080E6, 0x000052]', 
        dataMode='regions', height=350, width=600));
    plot(Geo2);
```

Again, Texas was the hardest hit with a total of 19,033 in the number of injuries and fatalities from JAN 1950 through NOV 2011.


```{r PopulationHealthGraph, include=T, echo=F, results='asis'}
#   Narrow Scope to Most Effected State: Texas
    HEALTH_TX_FULL <- subset(StormData, STATE_NAME=="Texas");
    HEALTH_TX <- ddply(HEALTH_TX_FULL, .(STATE_NAME, EVTYPE), summarise, 
        HEALTH=sum(HEALTH));

#   Top 5 EVTYPE
    HEALTH <- head(HEALTH_TX[order(-HEALTH_TX$HEALTH), ], n=5);

    g2 <- ggplot(data=HEALTH, aes(x="", y=HEALTH/sum(HEALTH), fill=EVTYPE))
    g2 <- g2 + geom_bar(width=.5, stat="identity")
    g2 <- g2 + ggtitle("Top 5 Events Affecting Population Health") 
    g2 <- g2 + labs(x="Texas", y="Injuries/Fatalities (%)")
    g2
```

The top five (5) extreme weather events attributed to well over 80% of the total number fatalities and injuries occuring in the state of Texas: 1) Tornado, 2) Flood, 3) Flash Flood, 4) Heat, and 5) TSTM Wind.

```{r echo=F}
    options(op);
```
