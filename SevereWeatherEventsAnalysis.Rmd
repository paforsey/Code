<!--
    %\VignetteEngine{knitr::knitr}
    %\VignetteIndexEntry{Markdown example with knitr and googleVis}
-->

---
title: "Severe Weather Events Analysis"
output: html_document
---

##Synopsis

This report explores the NOAA Storm Events Database in an attempt to determine which types of severe weather events are most harmful in terms of not only property damage, buth population health as well.  The purpose of this report is to provide government or municipal manager(s) with a enough information to make informed decisions as it pertains to effectively allocating limited resources.

The events in the database start in the year 1950 and end in November 2011.

[Findings...]


```{r Libraries, include=F, eval=T, echo=F}
    suppressWarnings(library(ggplot2));
    suppressWarnings(library(dplyr));
    suppressWarnings(library(plyr));
    suppressWarnings(library(downloader));
    suppressWarnings(library(R.utils));
    suppressWarnings(library(googleVis));
    suppressWarnings(library(formatR));
```

```{r echo=F}
    op <- options(gvis.plot.tag='chart');
```

###Download & Uncompress Dataset
```{r DownloadData, eval=F, echo=T}

    knitr::opts_chunk$set(cache=T);

    setwd("~/Data Science/05 Reproducible Research");
    
    csv <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2";
    download(csv, "repdata-data-StormData.csv.bz2", mode="wb");
    bunzip2("repdata-data-StormData.csv.bz2", "StormData.csv", overwrite=T);

```

###Read CSV File & Process Data
```{r ReadProcessCSV, eval=T, echo=T, cache=T}

    knitr::opts_chunk$set(cache=T);

#   Reading NOAA Data from CSV File
    NOAA_Full <- suppressWarnings(read.csv("StormData.csv", na.strings=""));
    dim(NOAA_Full);
    
#   Appending State Names to Dataset
    StateNames <- suppressWarnings(read.csv("states.csv"));
    dim(StateNames);

    StormDataFull <- merge(x=NOAA_Full, y=StateNames, by="STATE", all.x=T);

#   Converting Units for PROPDMGEXP & CROPDMGEXP
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="M"] <- 1000000;
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="K"] <- 1000;
    StormDataFull$PROP_SCALE[is.na(StormDataFull$PROPDMGEXP)==T] <- 1;

    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="M"] <- 1000000;
    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="K"] <- 1000;
    StormDataFull$CROP_SCALE[is.na(StormDataFull$CROPDMGEXP)==T] <- 1;

#   Scaling and Combing Values for Property & Crop Damage 
    StormDataFull$ECONOMIC <- (StormDataFull$PROPDMG * StormDataFull$PROP_SCALE) + 
        (StormDataFull$CROPDMG * StormDataFull$CROP_SCALE);

#   Scaling and Combining Values for Injuries & Fatalities
    StormDataFull$HEALTH <- StormDataFull$INJURIES + StormDataFull$FATALITIES;

#   Narrow Scope of Dataset
    StormData <- StormDataFull[, c("STATE_NAME", "EVTYPE", "ECONOMIC", "HEALTH")];

#   Aggregate Data by State
    StormData_ECONOMIC <- ddply(StormData, "STATE_NAME", summarise, ECONOMIC=sum(ECONOMIC));
    StormData_HEALTH <- ddply(StormData, "STATE_NAME", summarise, HEALTH=sum(HEALTH));

#   Narrow Scope to Minnesota, Arkansas, & New York
    ECONOMIC_MN_FULL <- subset(StormData, STATE_NAME=="Minnesota");
    ECONOMIC_AK_FULL <- subset(StormData, STATE_NAME=="Arkansas");
    ECONOMIC_NY_FULL <- subset(StormData, STATE_NAME=="New York");
    
    ECONOMIC_MN <- ddply(ECONOMIC_MN_FULL, .(STATE_NAME, EVTYPE), summarise, 
        ECONOMIC=sum(ECONOMIC));
    ECONOMIC_AK <- ddply(ECONOMIC_AK_FULL, .(STATE_NAME, EVTYPE), summarise, 
        ECONOMIC=sum(ECONOMIC));
    ECONOMIC_NY <- ddply(ECONOMIC_NY_FULL, .(STATE_NAME, EVTYPE), summarise, 
        ECONOMIC=sum(ECONOMIC));

#   Narrow Scope to Texas
    HEALTH_TX_FULL <- subset(StormData, STATE_NAME=="Texas");
    
    HEALTH_TX <- ddply(HEALTH_TX_FULL, .(STATE_NAME, EVTYPE), summarise, 
        HEALTH=sum(HEALTH));

#   Top 10 EVTYPE
    ECONOMIC_MN <- head(ECONOMIC_MN[order(ECONOMIC_MN$STATE_NAME, -ECONOMIC_MN$ECONOMIC), ],
        n=5);
    ECONOMIC_AK <- head(ECONOMIC_AK[order(ECONOMIC_AK$STATE_NAME, -ECONOMIC_AK$ECONOMIC), ],
        n=5);    
    ECONOMIC_NY <- head(ECONOMIC_NY[order(ECONOMIC_NY$STATE_NAME, -ECONOMIC_NY$ECONOMIC), ],
        n=5);
    
    ECONOMIC <- rbind(ECONOMIC_MN, ECONOMIC_AK, ECONOMIC_NY);
    
    HEALTH <- head(HEALTH_TX[order(-HEALTH_TX$HEALTH), ], n=5);

```


###Economic Impact


```{r EconomicsImpactMap, include=T, echo=T, results='asis', tidy=F}
    Geo <- gvisGeoMap(StormData_ECONOMIC, locationvar='STATE_NAME', numvar='ECONOMIC', 
        options=list(region='US', colors='[0xFF8747, 0xFFB581, 0xc06000]', 
        dataMode='regions', height=350, width=600));
    plot(Geo);
```

```{r EconomicsImpactGraph, include=T, echo=T, results='asis', tidy=F}
    g <- ggplot(data=ECONOMIC, aes(x=STATE_NAME, y=ECONOMIC/sum(ECONOMIC), fill=EVTYPE))
    g <- g + geom_bar(width=.5, stat="identity")
    g <- g + ggtitle("Economic Impact") 
    g <- g + labs(x="State(s)", y="Injuries/Fatalities (%)")
    g
    
```


###Population Health


```{r PopulationHealthMap, include=T, echo=T, results='asis', tidy=F}
    Geo <- gvisGeoMap(StormData_HEALTH, locationvar='STATE_NAME', numvar='HEALTH', 
        options=list(region='US', colors='[0xFF8747, 0xFFB581, 0xc06000]', 
        dataMode='regions', height=350, width=600));
    plot(Geo);
```


Upon closer examination of Texas, the top five (5) extreme weather events represent well over 80% of the total number fatalities and injuries occuring in that state.  The following graph provides a relative rank ordering of these weather events.

```{r PopulationHealthGraph, include=T, echo=T, results='asis', tidy=F}
    g <- ggplot(data=HEALTH, aes(x="", y=HEALTH/sum(HEALTH), fill=EVTYPE))
    g <- g + geom_bar(width=.5, stat="identity")
    g <- g + ggtitle("Population Health") 
    g <- g + labs(x="Texas", y="Injuries/Fatalities (%)")
    g

```

```{r echo=F}
    options(op);

```
