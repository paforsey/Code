<!--
    %\VignetteEngine{knitr::knitr}
    %\VignetteIndexEntry{Markdown example with knitr and googleVis}
-->

---
title: "Severe Weather Events Analysis"
output: html_document
---

##Synopsis

This report explores the NOAA Storm Events Database in an attempt to determine which types of severe weather events are most harmful in terms of not only property, but population health as well.  The purpose of this report is to provide government or municipal manager(s) with a enough information to make informed decisions as it pertains to effectively allocating limited resources.

Analysis revealed that the state of Texas was most affected by severe weather events from JAN 1950 through NOV 2011.  During this period of time, the state experienced approximately $19.5 Billion in property damage and more than 19,000 injuries and fatalities that can be directly attributed to Tornado, Hail, Flood, Flash Flood, Wild Fire, Heat, and TSTM Wind. 

Does the analysis address the question of which types of events are most harmful to population health?

Does the analysis address the question of which types of events have the greatest economic consequences?

Do the figure(s) have descriptive captions (i.e. there is a description near the figure of what is happening in the figure)?

Does the analysis include description and justification for any data transformations?
 
```{r Libraries, include=F, eval=T, echo=F}
    suppressWarnings(library(ggplot2));
    suppressWarnings(library(dplyr));
    suppressWarnings(library(plyr));
    suppressWarnings(library(downloader));
    suppressWarnings(library(R.utils));
    suppressWarnings(library(googleVis));
    suppressWarnings(library(formatR));
```

```{r echo=F}
    op <- options(gvis.plot.tag='chart');
```
 
 
##Data Processing
describes how the data were loaded into R and processed for analysis
```{r DataProcessing, eval=F, echo=T}
    knitr::opts_chunk$set(cache=T);

#   Set Working Directory
    setwd("~/Data Science/05 Reproducible Research");

#   Download & Uncompress CSV File
    csv <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2";
    download(csv, "repdata-data-StormData.csv.bz2", mode="wb");
    bunzip2("repdata-data-StormData.csv.bz2", "StormData.csv", overwrite=T);
```

```{r ReadProcessCSV, eval=T, echo=T, cache=T}

#   Reading NOAA Severe Weather Events Data
    NOAA_Full <- read.csv("StormData.csv", na.strings=c("","  ", "NA"),
        header=TRUE, sep=",", stringsAsFactors=FALSE, strip.white=TRUE, comment.char="",
        quote = '\"')[,1:35];  # Dropping Last Two Variables
    
    dim(NOAA_Full);
        
#   Appending State Names to Dataset
    StateNames <- suppressWarnings(read.csv("states.csv"));
    StormDataFull <- merge(x=NOAA_Full, y=StateNames, by="STATE", all.x=T);
    
    dim(StateNames);

#   Converting Units for PROPDMGEXP & CROPDMGEXP
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="M"] <- 1000;
    StormDataFull$PROP_SCALE[StormDataFull$PROPDMGEXP=="K"] <- 1;
    StormDataFull$PROP_SCALE[is.na(StormDataFull$PROPDMGEXP)==T] <- 1;

    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="M"] <- 1000;
    StormDataFull$CROP_SCALE[StormDataFull$CROPDMGEXP=="K"] <- 1;
    StormDataFull$CROP_SCALE[is.na(StormDataFull$CROPDMGEXP)==T] <- 1;
```
 
 
##Results
Severe weather events are evaluated in terms of their impact on both property and population health.  These quantitative measures are defined as follows:

Economic Impact = Amount of Property Damage + Amount of Crop Damage

Population Health = Number of Injuries + Number of Fatalities
````{r}
#   Scaling and Grouping Values for Property & Crop Damage 
    StormDataFull$ECONOMIC <- (StormDataFull$PROPDMG * StormDataFull$PROP_SCALE) + 
        (StormDataFull$CROPDMG * StormDataFull$CROP_SCALE);

#   Scaling and Combining Values for Injuries & Fatalities
    StormDataFull$HEALTH <- StormDataFull$INJURIES + StormDataFull$FATALITIES;

#   Narrow Scope of Dataset
    StormData <- StormDataFull[, c("STATE_NAME", "EVTYPE", "ECONOMIC", "HEALTH")];
```
 
 
###Economic Impact
Total Amount of Property Damage

```{r EconomicsImpactGraph, include=T, echo=T, results='asis'}
#   Property Damage
    ECONOMIC_FULL <- ddply(StormData, .(EVTYPE), summarise, 
        ECONOMIC=sum(ECONOMIC, na.rm=T)/1000000);
    ECONOMIC_FULL$ECONOMIC <- round(ECONOMIC_FULL$ECONOMIC, digits=2);
    
#   Property Damage: Top 10 EVTYPE
    ECONOMIC <- ECONOMIC_FULL[order(-ECONOMIC_FULL$ECONOMIC), ];
    ECONOMIC <- head(ECONOMIC[ECONOMIC$ECONOMIC>0, ], n=10);
    
    ## Property Damage Column Chart
    Column1 <- gvisColumnChart(ECONOMIC,
        options=list(legend='none', height=350, width=600, 
        title="Property Damage: Top 10 Events", hAxis="{title:'Severe Weather Event'}", 
        vAxis="{title:'Property Damage ($ Billions)'}"));
    plot(Column1);
    
```

Figure 1.1: The top ten severe weather events are responsible well over 80% of the total amount of property damage.

```{r EconomicsImpactMap, include=T, echo=T, results='asis'}
#   Aggregate Property Damage Data by State
    StormData_ECONOMIC <- ddply(StormData, "STATE_NAME", summarise, 
        ECONOMIC=sum(ECONOMIC, na.rm=T)/1000000);  # Round to Billions
    StormData_ECONOMIC$ECONOMIC <- round(StormData_ECONOMIC$ECONOMIC, digits=2);

#   Geograhic Representation of Property Damage by State
    Geo1 <- gvisGeoMap(StormData_ECONOMIC, locationvar='STATE_NAME', numvar='ECONOMIC', 
        options=list(region='US', colors='[0xA36685, 0x470024]', height=350, width=600,
        title="Total Property Damage", dataMode='regions'));
    plot(Geo1);
```
Figure 1.2: Texas was the hardest hit with a total of $19.5 Billion in combined property and crop damage.
 
 
###Population Health
Total Number of Injuries & Fatalities

```{r PopulationHealthGraph, include=T, echo=T, results='asis'}
#   Population Health
    HEALTH_FULL <- ddply(StormData, .(EVTYPE), summarise, 
        HEALTH=sum(HEALTH, na.rm=T));
    
#   Population Health: Top 10 EVTYPE
    HEALTH <- HEALTH_FULL[order(-HEALTH_FULL$HEALTH), ];
    HEALTH <- head(HEALTH[HEALTH$HEALTH>0, ], n=10);
    
    ## Property Damage Column Chart
    Column2 <- gvisColumnChart(HEALTH,
        options=list(legend='none', height=350, width=600, 
        title="Population Health: Top 10 Events", hAxis="{title:'Severe Weather Event'}", 
        vAxis="{title:'Injuries & Fatalities'}"));
    plot(Column2);
```

Figure 2.1: The top five severe weather events attributed to well over 80% of the total number fatalities and injuries.

```{r PopulationHealthMap, include=T, echo=T, results='asis'}
#   Aggregate Population Health Data by State
    StormData_HEALTH <- ddply(StormData, "STATE_NAME", summarise, HEALTH=sum(HEALTH, 
        na.rm= T));

#   Geographic Representation of Population Health Data by State
    Geo2 <- gvisGeoMap(StormData_HEALTH, locationvar='STATE_NAME', numvar='HEALTH', 
        options=list(region='US', colors='[0x8080E6, 0x000052]', 
        dataMode='regions', height=350, width=600));
    plot(Geo2);
```

Figure 2.2: Again, Texas was the hardest hit with a total of 19,033 in the number of injuries and fatalities.

```{r echo=F}
    options(op);
```
